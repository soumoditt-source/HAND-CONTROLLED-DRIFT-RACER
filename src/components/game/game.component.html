
<!-- 
  Hand Gesture Racing Game Interface
  Developed by: Soumoditya Das (soumoditt@gmail.com)
  Copyright (c) 2024. All rights reserved.
-->
<div class="relative w-full h-full bg-black overflow-hidden select-none font-orbitron text-white">
  
  <!-- THREE.JS CANVAS LAYER -->
  <div #canvasContainer class="absolute inset-0 z-0"></div>

  <!-- 
    PERSISTENT CAMERA CONTAINER 
    Fix: Kept outside @if blocks to ensure ElementRef exists during initialization.
    Transitions from hidden state to HUD position when game runs.
  -->
  <div [class]="gameState() === 'RUNNING' 
       ? 'absolute top-4 left-4 md:top-6 md:left-6 z-20 rounded-xl overflow-hidden border-2 border-cyan-500/50 shadow-[0_0_20px_rgba(6,182,212,0.4)] bg-black/60 backdrop-blur-sm transition-all duration-500' 
       : 'absolute top-0 left-0 w-1 h-1 overflow-hidden opacity-0 pointer-events-none'">
       
       <video #webcamVideo autoplay playsinline muted class="w-32 md:w-48 h-auto transform scale-x-[-1] opacity-90"></video>
       
       <!-- Camera Overlays (Only visible in game) -->
       @if(gameState() === 'RUNNING') {
          <div class="absolute top-0 right-0 p-1">
              <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
          </div>
          <div class="absolute bottom-0 w-full bg-cyan-900/80 text-[10px] text-center font-bold tracking-widest py-1 text-cyan-200">
              SYSTEM ONLINE
          </div>
       }
  </div>

  <!-- GAME HUD (Visible only when RUNNING) -->
  @if(gameState() === 'RUNNING') {
  <div class="absolute inset-0 z-10 pointer-events-none flex flex-col justify-between p-4 md:p-6 animate-fade-in">
    
    <!-- TOP BAR -->
    <div class="flex justify-between items-start">
        <!-- Spacer for Camera (Positioned absolutely above) -->
        <div class="w-32 md:w-48"></div>

        <!-- Score & Stats -->
        <div class="flex flex-col items-end gap-2">
            <div class="bg-gradient-to-l from-black/80 to-transparent pl-8 pr-4 py-2 rounded-l-xl border-r-4 border-yellow-400">
                <div class="text-yellow-400 text-[10px] font-bold tracking-[0.2em] uppercase">Current Session</div>
                <div class="text-4xl md:text-5xl font-black drop-shadow-md tabular-nums">
                    {{ score() | number:'1.0-0' }}
                </div>
            </div>
            <div class="flex items-center gap-2 bg-black/40 px-3 py-1 rounded text-xs text-gray-400 font-mono">
                <span>BEST:</span>
                <span class="text-white font-bold">{{ highScore() | number:'1.0-0' }}</span>
            </div>
        </div>
    </div>

    <!-- CENTER FEEDBACK -->
    <div class="absolute top-1/4 w-full text-center left-0 pointer-events-none">
        @if(currentSteerState().includes('DRIFT')) {
             <div class="inline-block px-6 py-2 transform -skew-x-12 bg-yellow-500/90 text-black font-black text-2xl tracking-widest shadow-lg animate-bounce">
                 DRIFTING!
             </div>
        }
    </div>

    <!-- BOTTOM INSTRUMENT CLUSTER -->
    <div class="flex items-end justify-center w-full pb-4 md:pb-8">
        <div class="relative flex items-center gap-6 md:gap-12 bg-black/70 backdrop-blur-md px-10 md:px-16 py-4 md:py-6 rounded-3xl border border-white/10 shadow-2xl">
            
            <!-- Pedals Indicators -->
            <div class="flex flex-col gap-3 opacity-90">
                <div class="flex items-center gap-3">
                    <div class="w-4 h-4 rounded-sm transition-all duration-150 border border-green-500/50" 
                         [class]="currentDriveState() === 'GAS' ? 'bg-green-500 shadow-[0_0_15px_lime] scale-110' : 'bg-gray-800'"></div>
                    <span class="text-[10px] font-bold text-gray-300 tracking-wider">THROTTLE</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-4 h-4 rounded-sm transition-all duration-150 border border-red-500/50" 
                         [class]="currentDriveState() === 'BRAKING' ? 'bg-red-500 shadow-[0_0_15px_red] scale-110' : 'bg-gray-800'"></div>
                    <span class="text-[10px] font-bold text-gray-300 tracking-wider">BRAKE</span>
                </div>
            </div>

            <!-- Digital Speedometer -->
            <div class="flex flex-col items-center w-32 md:w-40">
                <div class="relative">
                     <span class="text-6xl md:text-8xl font-black italic tracking-tighter tabular-nums leading-none bg-clip-text text-transparent bg-gradient-to-b from-white to-gray-400">
                         {{ speedKph() }}
                     </span>
                </div>
                <div class="w-full h-1 bg-gray-700 mt-2 rounded-full overflow-hidden">
                    <div class="h-full bg-cyan-400 transition-all duration-75" [style.width.%]="(speedKph() / 320) * 100"></div>
                </div>
                <div class="text-xs text-cyan-400 font-bold tracking-[0.4em] mt-1">KM/H</div>
            </div>

            <!-- Gear Indicator -->
            <div class="flex flex-col items-center border-l border-white/20 pl-6 md:pl-10">
                <div class="text-yellow-500 text-[10px] font-bold tracking-widest mb-1">GEAR</div>
                <div class="w-14 h-14 md:w-16 md:h-16 bg-gray-900 rounded-lg flex items-center justify-center border border-yellow-500/50 shadow-[inset_0_0_20px_rgba(234,179,8,0.2)]">
                    <span class="text-3xl md:text-4xl font-black text-white">{{ currentGear() }}</span>
                </div>
            </div>

        </div>
    </div>
  </div>
  }

  <!-- MAIN MENU SCREEN -->
  @if(gameState() === 'IDLE') {
    <div class="absolute inset-0 z-50 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-blue-900 via-gray-900 to-black flex flex-col items-center justify-center pointer-events-auto p-4">
        
        <!-- Game Title -->
        <h1 class="text-6xl md:text-9xl font-black italic tracking-tighter mb-2 drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)]">
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600">GESTURE</span>
            <span class="text-white ml-2">RACER</span>
        </h1>
        <div class="text-sm md:text-xl text-blue-300 tracking-[0.5em] font-bold mb-12 uppercase opacity-80">
            Professional Simulator by Soumoditya Das
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-2 gap-8 mb-12 w-full max-w-2xl">
            <div class="bg-white/5 border border-white/10 p-6 rounded-2xl text-center backdrop-blur hover:bg-white/10 transition-colors">
                <div class="text-gray-400 text-xs tracking-widest mb-2">LAST RUN</div>
                <div class="text-4xl font-bold text-white">{{ lastScore() | number:'1.0-0' }}</div>
            </div>
            <div class="bg-white/5 border border-yellow-500/30 p-6 rounded-2xl text-center backdrop-blur hover:bg-yellow-500/10 transition-colors shadow-[0_0_30px_rgba(234,179,8,0.1)]">
                <div class="text-yellow-500 text-xs tracking-widest mb-2">HIGH SCORE</div>
                <div class="text-4xl font-bold text-yellow-400">{{ highScore() | number:'1.0-0' }}</div>
            </div>
        </div>

        <!-- Gesture Instructions -->
        <div class="flex gap-4 md:gap-8 mb-12 text-sm md:text-base">
            <div class="flex flex-col items-center gap-2">
                <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center text-2xl border border-green-500/50">‚úã</div>
                <span class="text-gray-300 font-bold">ACCELERATE</span>
            </div>
            <div class="flex flex-col items-center gap-2">
                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center text-2xl border border-red-500/50">‚úä</div>
                <span class="text-gray-300 font-bold">BRAKE</span>
            </div>
             <div class="flex flex-col items-center gap-2">
                <div class="w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center text-2xl border border-yellow-500/50">üëê</div>
                <span class="text-gray-300 font-bold">STEER</span>
            </div>
        </div>

        <button (click)="startGame()" class="group relative px-16 py-6 bg-white text-black font-black text-2xl rounded-full shadow-[0_0_40px_rgba(255,255,255,0.4)] overflow-hidden transition-all hover:scale-105 hover:shadow-[0_0_60px_rgba(255,255,255,0.6)]">
            <span class="relative z-10 flex items-center gap-3">
                START ENGINE <span class="group-hover:translate-x-1 transition-transform">‚Üí</span>
            </span>
            <div class="absolute inset-0 bg-gradient-to-r from-cyan-400 to-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        </button>
        
        <div class="mt-8 text-gray-500 text-xs">v2.1 | REQUIREMENT: CAMERA ACCESS</div>
    </div>
  }

  <!-- LOADING SCREEN -->
  @if(gameState() === 'LOADING') {
      <div class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center">
          <div class="relative w-24 h-24">
              <div class="absolute inset-0 border-4 border-gray-800 rounded-full"></div>
              <div class="absolute inset-0 border-4 border-t-cyan-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"></div>
          </div>
          <div class="mt-8 text-cyan-400 font-mono text-sm tracking-widest animate-pulse">{{ loadingMessage() }}</div>
      </div>
  }

  <!-- GAME OVER SCREEN -->
  @if(gameState() === 'GAME_OVER') {
      <div class="absolute inset-0 z-50 bg-red-950/90 backdrop-blur-md flex flex-col items-center justify-center pointer-events-auto">
          <h1 class="text-8xl md:text-[10rem] text-white font-black italic mb-4 transform -rotate-6 opacity-20 absolute select-none">CRASHED</h1>
          
          <div class="relative bg-black/80 p-12 rounded-3xl border border-red-500/30 text-center shadow-2xl max-w-lg w-full">
              <h2 class="text-3xl font-bold text-red-500 mb-8 tracking-widest">MISSION FAILED</h2>
              
              <div class="space-y-6 mb-10">
                  <div>
                      <div class="text-gray-400 text-xs tracking-widest mb-1">DISTANCE SCORE</div>
                      <div class="text-6xl font-black text-white">{{ score() | number:'1.0-0' }}</div>
                  </div>
                  @if(score() >= highScore()) {
                      <div class="inline-block px-4 py-1 bg-yellow-500 text-black text-xs font-bold rounded animate-pulse">
                          NEW HIGH SCORE!
                      </div>
                  } @else {
                      <div class="text-xs text-gray-500">Record: {{ highScore() | number:'1.0-0' }}</div>
                  }
              </div>

              <div class="flex gap-4 justify-center">
                  <button (click)="restartGame()" class="flex-1 px-8 py-4 bg-white hover:bg-gray-200 text-black font-bold text-lg rounded-xl transition-colors">
                      RETRY
                  </button>
                  <button (click)="gameState.set('IDLE')" class="px-8 py-4 bg-transparent border border-white/20 hover:bg-white/10 text-white font-bold text-lg rounded-xl transition-colors">
                      MENU
                  </button>
              </div>
          </div>
      </div>
  }

</div>
